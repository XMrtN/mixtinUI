---
import Menu from "../icons/menu.astro";
import NavbarBrand from "./NavbarBrand.astro";
import Section from "./Section.astro";
import Sidebar from "./Sidebar.astro";
import ThemeToggle from "./ThemeToggle.astro";
import { getSession } from "auth-astro/server";

const session = await getSession(Astro.request);
const { class: className, ...rest } = Astro.props;
const { pathname } = Astro.url;
---

<nav
  class="group sticky left-0 top-0 z-[9999] flex min-h-16 items-center py-4"
  {...rest}
>
  <div
    class="absolute inset-0 -z-10 size-full bg-white/70 shadow backdrop-blur-xl dark:bg-neutral-900/70"
  >
  </div>
  <Section class="flex w-full items-center gap-4 px-6">
    <Menu class="sm:hidden" />
    <NavbarBrand class:list={[pathname === "/" && "max-sm:hidden"]} />

    <div class="ml-auto flex items-center justify-center gap-x-4">
      {
        !pathname.includes("/docs/") && (
          <a
            href="/docs/"
            class="font-medium hover:text-sky-500 dark:hover:text-sky-400"
          >
            Docs
          </a>
        )
      }
      <ThemeToggle />
    </div>
    {
      session && (
        <a href="/playground">
          <img
            src={session.user?.image ?? "/profile.webp"}
            alt={`Perfil de ${session.user?.name}`}
            class="size-8 rounded-full"
          />
        </a>
      )
    }
  </Section>

  <Sidebar variant="nav">
    <div class="flex items-center gap-3.5 px-6">
      <Menu class="sm:hidden" />
      <NavbarBrand />
    </div>
  </Sidebar>
</nav>

<script is:inline>
  const navbar = document.querySelector("nav");
  const menuBtns = document.querySelectorAll("nav svg");

  menuBtns.forEach((item) => {
    item.addEventListener("click", () => {
      navbar.toggleAttribute("data-open");
    });

    document.addEventListener("click", (e) => {
      if (!navbar.contains(e.target) && e.target !== item) {
        navbar.removeAttribute("data-open");
      }
    });
  });
</script>
